"use strict";!function(t,r,m){function y(a,e){var r=void 0!==a["fields-data"]["field-types"],n=a["fields-data"].fields;return m.each(e,function(e,t){r?(m.each(a["fields-data"]["field-types"],function(e,a){a.type===t.meta.id&&(n=a.fields)}),m.each(t.values,function(e,a){a.id=n[e].id})):m.each(t.values,function(e,a){a.id=n[e].id})}),e}t.AO=t.AO||{},m(function(){var e=m(".jsAlchemyRepeaterField");if(e[0]){var s=m(r),p=AlchemyRepeatersData["add-repeatee"],o=AlchemyRepeatersData["clone-repeatee"],d=AlchemyRepeatersData.misc,a=new URL(t.location.href),h=a.searchParams.get("page")||a.searchParams.get("post");e.each(function(e,a){var t=m(a),r=t.children(".field__content").children(".jsAlchemyRepeaterItems"),l=r.children(".jsAlchemyRepeatee").length;t.on("click",".jsAlchemyAddRepeatee",function(e){e.stopPropagation();var a=m(this),t=a.closest(".jsAlchemyRepeaterField"),r=t.data("alchemy"),n=a.data("repeater"),i=t.children(".field__content").children(".jsAlchemyRepeaterItems"),d=new FormData;a.attr("disabled",!0).next(".jsAlchemyRepeaterLoader").removeClass("alchemy__spinner--hidden"),d.append("_wpnonce",p.nonce),d.append("page-id",h),d.append("repeatees-number",++l),d.append("id",r.id),d.append("repeater-id",r["repeater-id"]),n&&n.type&&(d.append("type-id",n.type.id),d.append("type-title",n.type.title)),m.ajax({method:"POST",url:p.url,dataType:"json",processData:!1,contentType:!1,data:d,success:function(e){if(e.success&&e.data){var a=m(e.data);i.append(a),s.trigger("alch_repeatee_added",{repeater:t,repeatee:a})}},complete:function(){s.click(),a.removeAttr("disabled").next(".jsAlchemyRepeaterLoader").addClass("alchemy__spinner--hidden")}})}),t.on("click",".jsAlchemyRepeateeToolbar",function(e){e.stopPropagation(),s.click();var a=m(this).closest(".repeatee");a.hasClass("repeatee--expanded")?(a.removeClass("repeatee--expanded"),s.trigger("alch_repeatee_closed",{repeater:t,repeatee:a})):(a.addClass("repeatee--expanded"),s.trigger("alch_repeatee_opened",{repeater:t,repeatee:a}))}),t.on("click",".jsAlchemyRepeateeRemove",function(){var e=m(this).closest(".repeatee");e.fadeOut(function(){e.remove()})}),t.on("click",".jsAlchemyRepeateeAction",function(a){var d=this;a.stopPropagation();var e,t,r,n,i=m(this),c=i.closest(".repeatee");switch(i.data("action")){case"hide":t=i,n=(r=c).data("meta"),t.toggleClass("repeatee__btn--active"),t.find("span").toggleClass("dashicons-visibility").toggleClass("dashicons-hidden"),r.removeAttr("style").toggleClass("repeatee--hidden"),n.visible=void 0!==n.visible&&!n.visible;break;case"clone":!function(){a.stopPropagation();var t=m(d),r=t.closest(".jsAlchemyRepeaterField"),n=r.data("alchemy"),i=new FormData;t.attr("disabled",!0).next(".jsAlchemyRepeaterLoader").removeClass("alchemy__spinner--hidden"),i.append("_wpnonce",o.nonce),i.append("page-id",h),i.append("repeatees-number",++l),i.append("id",n.id),i.append("repeater-id",n["repeater-id"]);var e=c.children(".repeatee__fields").children(".jsAlchemyField").map(function(e,a){var t=m(a).data("alchemy");return new Function("return AO['get_".concat(t.type,"_value']('").concat(t.id,"');"))(t.id)}).get();Promise.all(e).then(function(e){var a=m.extend({},c.data("meta"));a.label=a.label?"".concat(a.label," copy"):"",a.title&&a.id&&(i.append("type-id",a.id),i.append("type-title",a.title)),e=y(n,[{meta:a,values:e}]),i.append("values",JSON.stringify(e)),m.ajax({method:"POST",url:o.url,dataType:"json",processData:!1,contentType:!1,data:i,success:function(e){if(e.success&&e.data){var a=m(e.data);c.after(a),s.trigger("alch_repeatee_added",{repeater:r,repeatee:a})}},complete:function(){s.click(),t.removeAttr("disabled").next(".jsAlchemyRepeaterLoader").addClass("alchemy__spinner--hidden")}})})}();break;case"delete":(e=c).fadeOut(function(){e.remove()})}}),t.on("click",".jsAlchemyRepeaterTypeTrigger",function(e){var a=m(this),t=a.closest(".repeater__add-from-type"),r=a.siblings(".jsAlchemyRepeaterFieldTypes");e.stopPropagation(),t.addClass("repeater__add-new--active"),r.addClass("repeater__field-types--visible"),s.one("click",function(){t.removeClass("repeater__add-new--active"),r.removeClass("repeater__field-types--visible")})}),t.on("click",".jsAlchemyRepeaterFieldTypes",function(e){e.stopPropagation()}),t.on({input:function(){var e=m(this),a=e.closest(".repeatee").data("meta"),t=e.val();a.label=t,e.prev(".jsRepeateeTitleText").text(t)},click:function(e){e.stopPropagation()}},".jsRepeateeTitle"),r.sortable({placeholder:"repeatee--placeholder",opacity:.8,axis:"y",handle:".jsRepeateeDndHandle",start:function(e,a){r.find(".repeatee--placeholder").height(a.helper.height()-2),AO.tinymce.save_editors(m(".jsAlchemyEditor",t))},stop:function(){AO.tinymce.restore_editors(m(".jsAlchemyEditor",t))}}),r.disableSelection();var n=t.find(".jsAlchRepeaterSelect").children("select"),i=d["add-from-type"]?d["add-from-type"]:"Add from type";n.select2({placeholder:i}).on("select2:select",function(e){s.click();var a=m(e.target),t=a.children('[value="'.concat(e.params.data.id,'"]')),r=a.closest(".jsAlchemyRepeaterField"),n=r.data("alchemy"),i=t.data("repeater"),d=r.children(".field__content").children(".jsAlchemyRepeaterItems"),c=new FormData;a.siblings(".jsAlchemyRepeaterLoader").removeClass("alchemy__spinner--hidden"),c.append("_wpnonce",p.nonce),c.append("page-id",h),c.append("repeatees-number",++l),c.append("id",n.id),c.append("repeater-id",n["repeater-id"]),i&&i.type&&(c.append("type-id",i.type.id),c.append("type-title",i.type.title)),m.ajax({method:"POST",url:p.url,dataType:"json",processData:!1,contentType:!1,data:c,success:function(e){if(e.success&&e.data){var a=m(e.data);d.append(a),s.trigger("alch_repeatee_added",{repeater:r,repeatee:a})}},complete:function(){a.removeAttr("disabled").val("").change().blur().siblings(".jsAlchemyRepeaterLoader").addClass("alchemy__spinner--hidden")}})})})}}),AO.get_repeater_value=function(t){var a=m(".jsAlchemyRepeaterField").filter(function(e,a){return t===m(a).data("alchemy").id}),e=a.children(".field__content").children(".jsAlchemyRepeaterItems").children(".jsAlchemyRepeatee").map(function(e,a){var t=m(a),r=t.data("meta"),n=t.children(".repeatee__fields").children(".jsAlchemyField").map(function(e,a){var t=m(a).data("alchemy");return new Function("return AO['get_".concat(t.type,"_value']('").concat(t.id,"');"))(t.id)}).get();return Promise.all(n).then(function(e){return Promise.resolve({meta:r,values:e})})}).get();return Promise.all(e).then(function(e){return Promise.resolve({type:"repeater:".concat(a.data("alchemy")["repeater-id"]),id:t,value:y(a.data("alchemy"),e)})})}}(window,document,jQuery);
//# sourceMappingURL=scripts.min.js.map